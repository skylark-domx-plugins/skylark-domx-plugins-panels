{"version":3,"sources":["TabStrip.js"],"names":["define","langx","browser","eventer","noder","geom","$","plugins","Dropdown","TabButton","panels","TabStrip","Plugin","inherit","klassName","pluginName","options","selectors","header","tab","content","tabpane","droptabs","dropdown","dropdownMenu","dropdownTabs","dropdownCaret","visibleTabs","auto","pullDropdownRight","_construct","elm","this","overrided","_velm","elmx","$header","$tabs","find","$content","$tabpanes","plugin","prototype","self","each","idx","tabEl","target","arrange","dropdownTabsSelector","visibleTabsSelector","$container","dropdownLabel","clone","remove","addClass","$dropdownTabs","$visibleTabs","tempElem","hiddenElementWidth","availableSpace","outerWidth","visibleTabsWidth","index","parseInt","x","get","reverse","hasClass","prependTo","first","appendTo","css","is","detach","insertAfter","length","hide","show","add","register"],"mappings":"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","file":"../TabStrip.js","sourcesContent":["define([\r\n    \"skylark-langx/langx\",\r\n    \"skylark-domx-browser\",\r\n    \"skylark-domx-eventer\",\r\n    \"skylark-domx-noder\",\r\n    \"skylark-domx-geom\",\r\n    \"skylark-domx-query\",\r\n    \"skylark-domx-plugins\",\r\n    \"skylark-domx-popups/Dropdown\",\r\n    \"skylark-domx-toggles/TabButton\",\r\n    \"./panels\",\r\n], function(langx, browser, eventer, noder, geom,  $, plugins,Dropdown, TabButton,panels) {\r\n\r\n    var TabStrip = plugins.Plugin.inherit({\r\n        klassName : \"TabStrip\",\r\n        pluginName : \"domx.panels.tabstrip\",\r\n\r\n        options : {\r\n          selectors : {\r\n            header : \".nav-tabs\",\r\n            tab : \"[data-toggle=\\\"tab\\\"]\",\r\n            content : \".tab-content\",\r\n            tabpane : \".tab-pane\"\r\n          },\r\n\r\n          droptabs : {\r\n            selectors : {\r\n              dropdown : \"li.droptabs\",\r\n              dropdownMenu    : \"ul.dropdown-menu\",\r\n              dropdownTabs    : \"li\",\r\n              dropdownCaret   : \"b.caret\",\r\n              visibleTabs     : \">li:not(.dropdown)\",\r\n            },\r\n            auto              : true,\r\n            pullDropdownRight : true,\r\n\r\n\r\n          }\r\n        },\r\n\r\n     _construct : function(elm,options) {\r\n          this.overrided(elm,options);\r\n          this._velm = this.elmx();\r\n          this.$header = this._velm.$(this.options.selectors.header); \r\n          this.$tabs = this.$header.find(this.options.selectors.tab);\r\n          this.$content = this._velm.$(this.options.selectors.content);\r\n          this.$tabpanes = this.$content.find(this.options.selectors.tabpane);\r\n\r\n          this.$header.find('[data-toggle=\"dropdown\"]').plugin(Dropdown.prototype.pluginName);\r\n\r\n          var self = this;\r\n          this.$tabs.each(function(idx,tabEl){\r\n            $(tabEl).plugin(TabButton.prototype.pluginName, {\r\n              target : self.$tabpanes[idx]\r\n            });\r\n          });\r\n\r\n        },\r\n\r\n        arrange : function () {\r\n\r\n          var dropdownTabsSelector = this.options.droptabs.selectors.dropdownTabs,\r\n              visibleTabsSelector = this.options.droptabs.selectors.visibleTabs;\r\n\r\n              $container = this.$header;\r\n          var dropdown = $container.find(this.options.droptabs.selectors.dropdown);\r\n          var dropdownMenu = dropdown.find(this.options.droptabs.selectors.dropdownMenu);\r\n          var dropdownLabel = $('>a', dropdown).clone();\r\n          var dropdownCaret = $(this.options.droptabs.selectors.dropdownCaret, dropdown);\r\n\r\n          // We only want the default label, strip the caret out\r\n          $(this.options.droptabs.selectors.dropdownCaret, dropdownLabel).remove();\r\n\r\n          if (this.options.droptabs.pullDropdownRight) {\r\n            $(dropdown).addClass('pull-right');\r\n          }\r\n\r\n          var $dropdownTabs = function () {\r\n            return $(dropdownTabsSelector, dropdownMenu);\r\n          }\r\n\r\n          var $visibleTabs = function () {\r\n            return $(visibleTabsSelector, $container);\r\n          }\r\n\r\n          function getFirstHiddenElementWidth() {\r\n            var tempElem=$dropdownTabs().first().clone().appendTo($container).css(\"position\",\"fixed\");\r\n            var hiddenElementWidth = $(tempElem).outerWidth();\r\n            $(tempElem).remove();\r\n            return hiddenElementWidth;\r\n          }\r\n\r\n          function getHiddenElementWidth(elem) {\r\n            var tempElem=$(elem).clone().appendTo($container).css(\"position\",\"fixed\");\r\n            var hiddenElementWidth = $(tempElem).outerWidth();\r\n            $(tempElem).remove();\r\n            return hiddenElementWidth;\r\n          }\r\n\r\n          function getDropdownLabel() {\r\n            var labelText = 'Dropdown';\r\n            if ($(dropdown).hasClass('active')) {\r\n              labelText = $('>li.active>a', dropdownMenu).html();\r\n            } else if (dropdownLabel.html().length > 0) {\r\n              labelText = dropdownLabel.html();\r\n            }\r\n\r\n            labelText = $.trim(labelText);\r\n\r\n            if (labelText.length > 10) {\r\n              labelText = labelText.substring(0, 10) + '...';\r\n            }\r\n\r\n            return labelText;\r\n          }\r\n\r\n          function renderDropdownLabel() {\r\n            $('>a', dropdown).html(getDropdownLabel() + ' ' + dropdownCaret.prop('outerHTML'));\r\n          }\r\n\r\n          function manageActive(elem) {\r\n            //fixes a bug where Bootstrap can't remove the 'active' class on elements after they've been hidden inside the dropdown\r\n            $('a', $(elem)).on('show.bs.tab', function (e) {\r\n              $(e.relatedTarget).parent().removeClass('active');\r\n            })\r\n            $('a', $(elem)).on('shown.bs.tab', function (e) {\r\n              renderDropdownLabel();\r\n            })\r\n\r\n          }\r\n\r\n          function checkDropdownSelection() {\r\n            if ($($dropdownTabs()).filter('.active').length > 0) {\r\n              $(dropdown).addClass('active');\r\n            } else {\r\n              $(dropdown).removeClass('active');\r\n            }\r\n\r\n            renderDropdownLabel();\r\n          }\r\n\r\n\r\n          var visibleTabsWidth = function () {\r\n            var visibleTabsWidth = 0;\r\n            $($visibleTabs()).each(function( index ) {\r\n              visibleTabsWidth += parseInt($(this).outerWidth(), 10);\r\n            });\r\n            visibleTabsWidth = visibleTabsWidth + parseInt($(dropdown).outerWidth(), 10);\r\n            return visibleTabsWidth;\r\n          }\r\n\r\n          var availableSpace = function () {\r\n            return $container.outerWidth()-visibleTabsWidth();\r\n          }\r\n\r\n          if (availableSpace()<0) {//we will hide tabs here\r\n            var x = availableSpace();\r\n            $($visibleTabs().get().reverse()).each(function( index ){\r\n              if (!($(this).hasClass('always-visible'))){\r\n                  $(this).prependTo(dropdownMenu);\r\n                  x=x+$(this).outerWidth();\r\n              }\r\n              if (x>=0) {return false;}\r\n            });\r\n          }\r\n\r\n          if (availableSpace()>getFirstHiddenElementWidth()) { //and here we bring the tabs out\r\n            var x = availableSpace();\r\n            $($dropdownTabs()).each(function( index ){\r\n              if (getHiddenElementWidth(this) < x && !($(this).hasClass('always-dropdown'))){\r\n                $(this).appendTo($container);\r\n                x = x-$(this).outerWidth();\r\n              } else {return false;}\r\n             });\r\n\r\n            if (!this.options.droptabs.pullDropdownRight && !$(dropdown).is(':last-child')) {\r\n              // If not pulling-right, keep the dropdown at the end of the container.\r\n              $(dropdown).detach().insertAfter($container.find('li:last-child'));\r\n            }\r\n          }\r\n\r\n          if ($dropdownTabs().length <= 0) {\r\n            dropdown.hide();\r\n          } else {\r\n            dropdown.show();\r\n          }\r\n        },\r\n\r\n        add : function() {\r\n          //TODO\r\n        },\r\n\r\n        remove : function(){\r\n          //TODO\r\n        }\r\n    });\r\n\r\n    plugins.register(TabStrip);\r\n\r\n\r\n    return panels.TabStrip = TabStrip;\r\n\r\n});"]}